<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>limia</title>
    <link rel="stylesheet" href='skin/css/style.css' type="text/css" />
 <!--   <link rel="stylesheet" type="text/css" href="skin/css/component.css" />-->
</head>
<body>
<div class="wrap">
    <header class="Header clear">
        <h1 class="Logo"><a href="#"><img src="skin/images/logo.png" alt="eve word" width="168" height="44"></a></h1>
        <nav class="Nav"><ul id="Menu">
            <li><a href="#"><span>首页<div class="Nav__line"></div></span>HOME</a></li>
            <li><a class="js-page-transition" href="#"><span>我的案例<div class="Nav__line"></div></span>WORK</a></li>
            <li><a class="js-page-transition" href="#"><span>我的博客<div class="Nav__line"></div></span>VIEW</a></li>
            <li><a class="js-page-transition"  href="#"><span>战斗技能<div class="Nav__line"></div></span>ABILITY</a></li>
            <li><a class="js-page-transition"  href="#"><span>关于我<div class="Nav__line"></div></span>ABOUT</a></li>
            <li><a class="js-page-transition" href="#"><span>联系我<div class="Nav__line"></div></span>CONTACT</a></li>
        </ul></nav>
    </header>

    <!--home-->
    <article id="JsfirstBlock" class="firstBlock ">
        <div class="firstBlock__inner">
        <h2 class="firstBlock__logo">
            <span><img src="skin/images/logo-home.png" alt="Victory" width="400" height="44"></span></h2>
        <ul class="firstBlock__items">
            <li class="firstBlock__item">
                <div class="firstBlock__item-inner">
                <h3><img src="skin/images/mission.png" alt="MISSION" ></h3>
                <p>关于我<br>&nbsp;</p>
                <a class="smoothing page-transition about" href="#" id="about" >DETAIL</a>
            </div>
            </li>
            <li class="firstBlock__item"><div class="firstBlock__item-inner">
                <h3><img src="skin/images/action.png" alt="IDENTITIY"></h3>
                <p>前端开发<br>&nbsp</p>
                <a class="smoothing page-transition"  href="#" id="work" >DETAIL</a>
            </div>
            </li>
            <li class="firstBlock__item"><div class="firstBlock__item-inner">
                <h3><img src="skin/images/solution.png" alt="SOLUTION" ></h3>
                <p>HTML5+CSS3<br>&nbsp</p>
                <a class="smoothing page-transition" href="#" id="ability" >DETAIL</a>
            </div></li>
        </ul>
    </div>
    </article>




</div>




<canvas id="canvas" class="canvas" width="1200" height="800">浏览器不支持canvas</canvas>
<img id="img1" style="display:none" src="skin/images/txt-rainbow.png" width="570" height="40" />




<script src='skin/js/jquery.min.js' type="text/javascript"></script>
<script src="skin/js/velocity.min.js"></script>
<script src="skin/js/velocity.ui.min.js"></script>
<!--<script src='http://hanzichi.github.io/common/vector.js'></script>
<script src='http://hanzichi.github.io/common/common.js'></script>-->
<script src="skin/js/common.js" type="text/javascript"></script>
<script>
    var TextParticles = function () {
        var extend = function (target, source, isOverwrite) {
            if (isOverwrite == undefined) isOverwrite = true;
            for (var key in source) {
                if (!(key in target) || isOverwrite) {
                    target[key] = source[key];
                }
            }
            return target;
        };
        var $ = function (id) {
            return document.getElementById(id) || id;
        };
        var $$ = function (tag, p) {
            return p.getElementsByTagName(tag);
        };
        var addEvent = function (o, e, f) {
            o.addEventListener ? o.addEventListener(e, f, false) : o.attachEvent('on'+e, function () {f.call(o)});
        }
        window.requesetAnimFrame = function () {
            return window.requesetAnimationFrame ||
                    window.webkitRequestAnimationFrame ||
                    window.mozRequestAnimationFrame ||
                    window.oRequestAnimationFrame ||
                    window.msRequestAnimationFrame ||
                    function (fn) {
                        window.setTimeout(fn, 1000/60);
                    };
        }();

        var mouseX = 0, mouseY = 0;
        function onMousemove (e) {
            mouseX = e.clientX;
            mouseY = e.clientY;
        }
        function onResize (e) {

        }

        var init = function (opt) {
            this.opt = {
                canvasId: null
            }
            this.place = 0;

            extend(this.opt, opt);

            this.initialize();
        }
        init.prototype = {
            initialize: function () {
                if (this.opt.canvasId == null) {
                    this.genCanvas();
                } else {
                    this.canvas = $(this.opt.canvasId);
                }

                this.particles = [];

                this.ctx = this.canvas.getContext('2d');
                this.setCvsStyle();
                this.fillText();
                this.getImageData();
                this.bindEvent();
                this.loop();
            },
            bindEvent: function () {
                var _this = this;
                addEvent(this.canvas, 'mousemove', onMousemove);
                addEvent(window, 'resize', function (e) {
                    _this.setCvsStyle();
                });
            },
            loop: function () {
                var _this = this;
                /*setInterval(function () {
                 _this.doFrame();
                 }, 20);
                 */
                requesetAnimFrame(function () {_this.loop()});
                this.doFrame();
            },
            doFrame: function () {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                for (var i = 0; i < this.particles.length; i ++) {
                    var p = this.particles[i];
                    p.update();
                }
            },
            getImageData: function () {
                var imageData = this.ctx.getImageData(0, 0, this.canvas.width, this.canvas.height);
                for (var x = 0; x < imageData.width; x ++) {
                    for (var y = 0; y < imageData.height; y ++) {
                        //var i = 4*(x * imageData.height + y);
                        var i = 4*(y * imageData.width + x);
                        if (imageData.data[i + 3] > 128) {
                            this.place ++;
                            (this.place%4 == 0) && this.particles.push(new Particle(x, y, this.canvas));
                        }
                    }
                }
            },
            fillText: function () {
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.ctx.font = '200px sans-serif';
                this.ctx.fillText('AlloyTeam', this.canvas.width/2, this.canvas.height/3);
            },
            setCvsStyle: function () {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            },
            genCanvas: function () {
                var canvas = document.createElement('canvas');
                document.body.appendChild(canvas);
                this.canvas = canvas;
                return canvas;
            }
        };

        var Particle = function (x, y, canvas) {
            this.endX = x;
            this.endY = y;
            this.canvas = canvas;
            this.ctx = this.canvas.getContext('2d');
            this.x = Math.random() * this.canvas.width;
            this.y = Math.random() * this.canvas.height;

            this.vx = Math.random()*10 - 5;
            this.vy = Math.random()*10 - 5;

        }
        Particle.prototype = {
            move: function () {
                var disX = this.endX - this.x;
                var disY = this.endY - this.y;
                var dis = Math.sqrt(Math.pow(disX, 2) + Math.pow(disY, 2));
                var force = dis * .01;
                var angle = Math.atan2(disY, disX); // atan2(x, y) 返回点(x, y)到x 轴的弧度

                var mouseF = 0, mouseA = 0;
                if (mouseX > 0 && mouseY > 0) {
                    var dis = Math.pow((this.x - mouseX), 2) + Math.pow((this.y - mouseY), 2);
                    mouseF = Math.min(5000/dis, 5000);
                    mouseA = Math.atan2(this.y - mouseY, this.x - mouseX);
                } else {
                    mouseF = 0;
                    mouseA = 0;
                }

                this.vx += force * Math.cos(angle) + mouseF * Math.cos(mouseA);
                this.vy += force * Math.sin(angle) + mouseA * Math.sin(mouseA);

                this.vx *= 0.92;
                this.vy *= .92;

                //
                this.x += this.vx;
                this.y += this.vy;
            },
            render: function () {
                this.ctx.fillStyle = '#111';
                this.ctx.fillRect(this.x, this.y, 2, 2);
            },
            update: function () {
                this.move();
                this.render();
            }
        }

        return init;
    }();

    onload = function () {
        new TextParticles();
    }
</script>

</body>
</html> 